{"version":3,"sources":["utils/like.js","utils/comment.js","components/Menu.js","screen/comment/CommentItem.js","screen/comment/CommentView.js","screen/video/VideoView.js"],"names":["useLikeItems","useAuth","user","result","useQuery","queryKey","_id","queryFn","userRequest","get","then","data","likes","catch","response","likeItems","useLikeItem","videoId","find","el","useCreateLikeItemInVideo","queryClient","useQueryClient","mutation","useMutation","video","post","title","channelTitle","channel","image","images","publishedAt","onSettled","invalidateQueries","onError","err","variables","recover","onMutate","prevVideoInfo","getQueryData","setQueryData","oldData","createLike","mutateAsync","useRemoveLikeItem","delete","prevLikeItems","R","removeLike","useRemoveLikeItemInVideo","useDefaultMutationOptions","MenuContext","createContext","Menu","children","useState","value","isOpen","setIsOpen","anchorRef","useRef","Provider","MenuOpenButton","child","useContext","cloneElement","onClick","callAll","props","ref","MenuCloseButton","MenuContent","className","handleClose","event","current","contains","target","Popper","open","anchorEl","transition","TransitionProps","placement","Grow","style","transformOrigin","Paper","ClickAwayListener","onClickAway","MenuList","autoFocusItem","fns","args","forEach","fn","styled","comment","setCurrentTypedComment","useParams","remove","customOptions","defaultOptions","commentId","videoRequest","mutate","useDeleteComment","flexy","Item","width","modifiers","src","process","photo","alt","spacing","name","as","MoreVert","MenuItem","renderActionBtn","list","useForm","register","handleSubmit","setValue","reset","currentTypedComment","doc","comments","useCommentSearch","isIdle","isLoading","isSuccess","useAsync","isMutateLoading","run","create","values","useCreateComment","update","patch","useUpdateComment","useEffect","onSubmit","type","placeholder","required","map","history","useVideoInfo","likeItem","createSubscribe","useCreateSubscribeItemInVideo","removeSubscribe","useRemoveSubscribeItemInVideo","subscribeItem","useSubscribeItem","descriptionShow","setDescriptionShow","videoSrc","handleSubscribeClick","clickCB","Date","createdAt","toLocaleDateString","year","month","day","views","pd","push","ThumbUp","Spinner","channelId","mb","Link","flexwidth","mr","to","subscribes","description","media","tabport"],"mappings":"iVAKA,SAASA,IAAgB,IAAD,IACJC,cAAVC,EADc,oBACdA,KACHC,EAASC,YAAS,CACvBC,SAAU,CAAC,aAAD,OAAeH,QAAf,IAAeA,OAAf,EAAeA,EAAMI,KAC/BC,QAAS,kBACRC,IACEC,IADF,kBACUP,QADV,IACUA,OADV,EACUA,EAAMI,IADhB,WAEEI,MAAK,qBAAGC,KAAQA,KAAkBC,SAClCC,OAAM,YACN,MADkC,EAAzBC,SAAYH,WAIzB,OAAO,2BAAKR,GAAZ,IAAoBY,UAAS,UAAEZ,EAAOQ,YAAT,QAAiB,KAI/C,SAASK,EAAYC,GAAU,IAAD,IACVhB,cACnB,OAF6B,oBACpBC,MAGT,UADsBF,IAAde,UACSG,MAAK,SAACC,GAAD,OAAQA,EAAGF,UAAYA,YAA7C,QAFkB,KAKnB,SAASG,EAAyBH,GAAU,IAAD,EACvBhB,cAAVC,EADiC,oBACjCA,KACHmB,EAAcC,cAEdC,EAAWC,aAChB,SAACC,GAAD,OACCjB,IAAYkB,KAAZ,kBAAqBxB,QAArB,IAAqBA,OAArB,EAAqBA,EAAMI,IAA3B,UAAwC,CACvCW,QAASQ,EAAMR,QACfU,MAAOF,EAAME,MACbC,aAAcH,EAAMI,QAAQF,MAC5BG,MAAOL,EAAMM,OACbC,YAAaP,EAAMO,gBAErB,CACCC,UAAW,WACVZ,EAAYa,kBAAkB,CAAC,aAAD,OAAehC,QAAf,IAAeA,OAAf,EAAeA,EAAMI,MACnDe,EAAYa,kBAAkB,CAAC,YAAa,CAAEjB,cAE/CkB,QAAS,SAACC,EAAKC,EAAWC,GACF,oBAAZA,GAEVA,KAGFC,SAAU,WACT,IAAMC,EAAgBnB,EAAYoB,aAAa,CAAC,YAAa,CAAExB,aAI/D,OAHAI,EAAYqB,aAAa,CAAC,YAAa,CAAEzB,aAAY,SAAC0B,GACrD,OAAO,2BAAKA,GAAZ,IAAqB/B,MAAO+B,EAAQ/B,MAAQ,OAEtC,kBAAMS,EAAYqB,aAAa,CAAC,YAAa,CAAEzB,YAAYuB,OAIrE,OAAO,2BAAKjB,GAAZ,IAAsBqB,WAAYrB,EAASsB,cAG5C,SAASC,IAAqB,IAAD,EACT7C,cAAVC,EADmB,oBACnBA,KACHmB,EAAcC,cAEdC,EAAWC,aAChB,gBAAGP,EAAH,EAAGA,QAAH,OAAiBT,IAAYuC,OAAZ,kBAAuB7C,QAAvB,IAAuBA,OAAvB,EAAuBA,EAAMI,IAA7B,kBAA0CW,MAC3D,CACCgB,UAAW,WACVZ,EAAYa,kBAAkB,CAAC,aAAD,OAAehC,QAAf,IAAeA,OAAf,EAAeA,EAAMI,OAEpD6B,QAAS,SAACC,EAAKC,EAAWC,GACF,oBAAZA,GAAwBA,KAEpCC,SAAU,YAAkB,IAAftB,EAAc,EAAdA,QACN+B,EAAgB3B,EAAYoB,aAAa,CAAC,aAAD,OAAevC,QAAf,IAAeA,OAAf,EAAeA,EAAMI,MAIpE,OAHAe,EAAYqB,aAAa,CAAC,aAAD,OAAexC,QAAf,IAAeA,OAAf,EAAeA,EAAMI,MAAM,SAACqC,GACpD,OAAOM,KAAS,SAAC9B,GAAD,OAAQA,EAAGF,UAAYA,IAAS0B,MAE1C,kBAAMtB,EAAYqB,aAAa,CAAC,aAAD,OAAexC,QAAf,IAAeA,OAAf,EAAeA,EAAMI,KAAM0C,OAIpE,OAAO,2BAAKzB,GAAZ,IAAsB2B,WAAY3B,EAASsB,cAG5C,SAASM,EAAyBlC,GAAU,IAAD,EACvBhB,cAAVC,EADiC,oBACjCA,KAEHmB,EAAcC,cAEdC,EAAWC,aAChB,gBAAGP,EAAH,EAAGA,QAAH,OAAiBT,IAAYuC,OAAZ,kBAAuB7C,QAAvB,IAAuBA,OAAvB,EAAuBA,EAAMI,IAA7B,kBAA0CW,MAC3D,CACCgB,UAAW,WACVZ,EAAYa,kBAAkB,CAAC,aAAD,OAAehC,QAAf,IAAeA,OAAf,EAAeA,EAAMI,MACnDe,EAAYa,kBAAkB,CAAC,YAAa,CAAEjB,cAE/CkB,QAAS,SAACC,EAAKC,EAAWC,GACF,oBAAZA,GAEVA,KAGFC,SAAU,WACT,IAAMC,EAAgBnB,EAAYoB,aAAa,CAAC,YAAa,CAAExB,aAK/D,OAJAI,EAAYqB,aAAa,CAAC,YAAa,CAAEzB,aAAY,SAAC0B,GACrD,GAAKA,EACL,OAAO,2BAAKA,GAAZ,IAAqB/B,MAAO+B,EAAQ/B,MAAQ,OAEtC,kBAAMS,EAAYqB,aAAa,CAAC,YAAa,CAAEzB,YAAYuB,OAIrE,OAAO,2BAAKjB,GAAZ,IAAsB2B,WAAY3B,EAASsB,gB,mNClG5C,SAASO,EAA0BnC,GAClC,IAAMI,EAAcC,cACpB,MAAO,CACNW,UAAW,kBAAMZ,EAAYa,kBAAkB,CAAC,gBAAiB,CAAEjB,e,mECnB/DoC,EAAcC,0BAEdC,EAAO,SAAC,GAAkB,IAAhBC,EAAe,EAAfA,SAAe,EACAC,oBAAS,GADT,mBAGtBC,EAAQ,CAAEC,OAHY,KAGJC,UAHI,KAGOC,UADjBC,iBAAO,OAEzB,OAAO,cAACT,EAAYU,SAAb,CAAsBL,MAAOA,EAA7B,SAAqCF,KAGzCQ,EAAiB,SAAC,GAAyB,IAAbC,EAAY,EAAtBT,SAAsB,EACZU,qBAAWb,GAApCO,EADqC,EACrCA,UAAWC,EAD0B,EAC1BA,UACnB,OAAOM,uBAAaF,EAAO,CACxBG,QAASC,GAAQ,kBAAMT,GAAU,KAAOK,EAAMK,MAAMF,SACpDG,IAAKV,KAILW,EAAkB,SAAC,GAAyB,IAAbP,EAAY,EAAtBT,SAAsB,EACbU,qBAAWb,GAApCO,EADsC,EACtCA,UAAWC,EAD2B,EAC3BA,UACnB,OAAOM,uBAAaF,EAAO,CACxBG,QAASC,GAAQ,kBAAMT,GAAU,KAAQK,EAAMK,MAAMF,SACrDG,IAAKV,KAILY,EAAc,SAAC,GAA6B,IAA3BjB,EAA0B,EAA1BA,SAA0B,KAAhBkB,UACWR,qBAAWb,IAA5CM,EADsC,EACtCA,OAAQC,EAD8B,EAC9BA,UAAWC,EADmB,EACnBA,UAErBc,EAAc,SAACC,GACdf,EAAUgB,SAAWhB,EAAUgB,QAAQC,SAASF,EAAMG,SAC1DnB,GAAU,IAGb,OACG,cAACoB,EAAA,EAAD,CAAQC,KAAMtB,EAAQuB,SAAUrB,EAAUgB,QAASM,YAAU,EAA7D,SACI,gBAAGC,EAAH,EAAGA,gBAAiBC,EAApB,EAAoBA,UAApB,OACE,cAACC,EAAA,EAAD,2BACOF,GADP,IAEGG,MAAO,CACJC,gBAA+B,WAAdH,EAAyB,aAAe,iBAH/D,SAMG,cAACI,EAAA,EAAD,UACG,cAACC,EAAA,EAAD,CAAmBC,YAAahB,EAAhC,SACG,cAACiB,EAAA,EAAD,CAAUC,cAAelC,EAAzB,SAAkCH,eASvD,SAASa,IAAiB,IAAD,uBAALyB,EAAK,yBAALA,EAAK,gBACtB,OAAO,WAAoB,IAAD,uBAANC,EAAM,yBAANA,EAAM,gBACvBD,EAAIE,SAAQ,SAACC,GACVA,GAAMA,EAAE,WAAF,EAAMF,O,+IClDrB,IA+CeG,eA/CK,SAAC,GAAoD,IAAlDC,EAAiD,EAAjDA,QAASC,EAAwC,EAAxCA,uBAAwB1B,EAAgB,EAAhBA,UAC7CzD,EAAYoF,cAAZpF,QAD6D,EAElDhB,cAAVC,EAF4D,oBAE5DA,KACDoG,EFmCX,SAA0BrF,EAASsF,GAClC,IAAMC,EAAiBpD,EAA0BnC,GAC3CM,EAAWC,aAChB,gBAAGiF,EAAH,EAAGA,UAAH,OAAmBC,IAAa3D,OAAb,WAAwB9B,EAAxB,qBAA4CwF,MADpC,YAAC,2BAGxBD,GACAD,GAJuB,IAK1BhE,SAAU,YAAoB,IAAjBkE,EAAgB,EAAhBA,UACZpF,IAAYqB,aAAa,CAAC,gBAAiB,CAAEzB,aAAY,SAAC0B,GACzD,OAAOM,KAAS,SAAC9B,GAAD,OAAQA,EAAGb,MAAQmG,IAAW9D,UAKlD,OAAO,2BAAKpB,GAAZ,IAAsB+E,OAAQ/E,EAASoF,SEjDlBC,CAAiB3F,GAA5BqF,OAwBR,OACG,eAAC,IAAD,CAAWO,MAAM,SAASnC,UAAWA,EAArC,UACG,cAAC,IAAUoC,KAAX,CAAgBC,MAAM,IAAtB,SACG,cAAC,IAAD,UACG,cAAC,IAAD,CACGC,UAAU,QACVC,IAAG,UAAKC,iDAAL,YAA0Cf,EAAQjG,KAAKiH,OAC1DC,IAAI,mBAIb,eAAC,IAAUN,KAAX,CAAgBC,MAAM,KAAKM,QAAQ,MAAnC,UACG,cAAC,IAAD,CAAWL,UAAW,CAAC,QAAS,QAAhC,SAA0Cb,EAAQjG,KAAKoH,OACvD,cAAC,IAAD,CAAWN,UAAU,QAArB,SAA8Bb,EAAQA,aAExCjG,GAAQA,EAAKI,MAAQ6F,EAAQjG,KAAKI,IArCzC,SAAyB6F,GACtB,OACG,cAAC,IAAUW,KAAX,UACG,eAAC,EAAD,WACG,cAAC,EAAD,UACG,cAAC,IAAD,CAAQE,UAAU,cAAlB,SACG,cAAC,IAAD,CAAMO,GAAIC,UAGhB,eAAC,EAAD,WACG,cAAC,EAAD,UACG,cAACC,EAAA,EAAD,CAAUrD,QAAS,kBAAMgC,EAAuBD,IAAhD,oBAEH,cAAC,EAAD,UACG,cAACsB,EAAA,EAAD,CAAUrD,QAAS,kBAAMkC,EAAO,CAAEG,UAAWN,EAAQ7F,OAArD,8BAuB6BoH,CAAgBvB,GAAW,UAK9DD,CAAf,K,2SC7CA,IAsEeA,eAtEK,SAAC,GAAmB,IAgCbyB,EAhCJjD,EAAgB,EAAhBA,UAAgB,EACjBzE,cAAVC,EAD2B,oBAC3BA,KACHe,EAAYoF,cAAZpF,QAF8B,EAGgB2G,cAA5CC,EAH4B,EAG5BA,SAAUC,EAHkB,EAGlBA,aAAcC,EAHI,EAGJA,SAAUC,EAHN,EAGMA,MAHN,EAIkBvE,mBAAS,MAJ3B,mBAI7BwE,EAJ6B,KAIR7B,EAJQ,OHNvC,SAA0BnF,GACzB,IAAMd,EAASC,YAAS,CACvBC,SAAU,CAAC,gBAAiB,CAAEY,YAC9BV,QAAS,kBACRmG,IACEjG,IADF,WACUQ,EADV,cAEEP,MAAK,qBAAGC,KAAQA,KAAkBuH,OAClCrH,OAAM,YACN,MADkC,EAAzBC,SAAYH,WAIzB,OAAO,2BAAKR,GAAZ,IAAoBgI,SAAUhI,EAAOQ,OGAgByH,CAAiBnH,GAA5DkH,EAL4B,EAK5BA,SAAUE,EALkB,EAKlBA,OAAQC,EALU,EAKVA,UAAWC,EALD,EAKCA,UALD,EAWhCC,cAJUC,EAPsB,EAOjCH,UAGAI,EAViC,EAUjCA,IAEKC,EHGX,SAA0B1H,EAASsF,GAClC,IAAMC,EAAiBpD,EAA0BnC,GAC3CM,EAAWC,aAAY,SAACoH,GAAD,OAAYlC,IAAahF,KAAb,WAAsBT,EAAtB,aAA0C2H,KAAvD,YAAC,eACzBpC,GACAD,IAEJ,OAAO,2BAAKhF,GAAZ,IAAsBoH,OAAQpH,EAASsB,cGTlBgG,CAAiB5H,GAA5B0H,OACAG,EHWX,SAA0B7H,EAASsF,GAClC,IAAMC,EAAiBpD,EAA0BnC,GAC3CM,EAAWC,aAChB,gBAAGiF,EAAH,EAAGA,UAAWN,EAAd,EAAcA,QAAd,OAA4BO,IAAaqC,MAAb,WAAuB9H,EAAvB,qBAA2CwF,GAAaN,KADzD,YAAC,eAGxBK,GACAD,IAGL,OAAO,2BAAKhF,GAAZ,IAAsBuH,OAAQvH,EAASsB,cGpBlBmG,CAAiB/H,GAA5B6H,OA+BR,OA9BAG,qBAAU,WACHhB,GAAqBF,EAAS,UAAWE,EAAoB9B,WACjE,CAAC8B,EAAqBF,IA4BrBM,GAAUC,GAAaG,EAAwB,cAAC,IAAD,IAC/CF,EAEE,sBAAK7D,UAAWA,EAAhB,UACIxE,EACE,eAAC,IAAD,CAAMwE,UAAU,gBAAgBwE,SAAUpB,GA1BtD,SAAqBc,GAIfF,EAHET,EAGEa,EAAO,CAAErC,UAAWwB,EAAoB3H,IAAK6F,QAASyC,IAFtDD,EAAOC,IAIdxC,EAAuB,SAoBd,UACG,cAAC,IAAD,CACGY,UAAU,cACVmC,KAAK,OACL7B,KAAK,UACL8B,YAAY,0BACZ7E,IAAKsD,EAAS,CACXwB,SAAU,+BAGhB,sBAAK3E,UAAU,qBAAf,UACG,cAAC,IAAD,CAAQN,QA1C1B,WACG4D,IACA5B,EAAuB,OAwCR,oBACA,cAAC,IAAD,CAAQY,UAAU,YAAlB,2BAGL,KACJ,+BAjCeW,EAiCMQ,EAhC3B,OAAOR,QAAP,IAAOA,OAAP,EAAOA,EAAM2B,KAAI,SAAsBnD,GACpC,OACG,cAAC,EAAD,CAEGA,QAASA,EACTC,uBAAwBA,GAFnBD,EAAQ7F,mBASzB,IAyBY4F,CAAf,K,olBCuEeA,uBA1HG,SAAC,GAA4B,IAAD,EAAzBqD,EAAyB,EAAzBA,QAAS7E,EAAgB,EAAhBA,UAAgB,EACxBzE,cAAVC,EADkC,oBAClCA,KACDe,EAAYoF,cAAZpF,QAFmC,EAGKuI,YAAavI,GAArDQ,EAHmC,EAGnCA,MAAO4G,EAH4B,EAG5BA,OAAQC,EAHoB,EAGpBA,UAAWC,EAHS,EAGTA,UAC5BkB,EAAWzI,YAAYC,GAJc,EAWvCuH,cALUC,EAN6B,EAMxCH,UAGAI,EATwC,EASxCA,IAIKgB,EAAoBC,YAA8B1I,GAAlDyI,gBACAE,EAAoBC,YAA8B5I,GAAlD2I,gBACAhH,EAAexB,YAAyBH,GAAxC2B,WACAM,EAAeC,YAAyBlC,GAAxCiC,WACF4G,EAAgBC,aAAsB,OAALtI,QAAK,IAALA,GAAA,UAAAA,EAAOI,eAAP,eAAgBvB,MAAO,MAjBnB,EAkBGmD,oBAAS,GAlBZ,mBAkBpCuG,EAlBoC,KAkBnBC,EAlBmB,KAmBrCC,EAAQ,wCAAoCjJ,GAElD,SAASkJ,EAAqBC,GAC3B,OAAO,WACJ1B,EAAI0B,MAIV,OAAI/B,GAAUC,EAER,cAAC,IAAD,CAAKvB,MAAM,KAAX,SACG,cAAC,IAAD,MAGLwB,EAEE,cAAC,IAAD,CAAKxB,MAAM,KAAKrC,UAAWA,EAA3B,SACG,sBAAKA,UAAU,QAAf,UACG,qBAAKA,UAAU,kBAAf,SACG,cAAC,IAAD,CAAOuC,IAAKiD,EAAUvI,MAAM,mBAE/B,eAAC,IAAD,CAAWkF,MAAM,SAASnC,UAAU,kBAApC,UACG,eAAC,IAAUoC,KAAX,CAAgBC,MAAM,KAAtB,UACG,cAAC,IAAD,CAAOC,UAAU,SAAjB,SAA2BvF,EAAME,QACjC,eAAC,IAAD,CAAWqF,UAAU,QAArB,UACI,IAAIqD,KAAK5I,EAAM6I,WAAWC,mBAAmB,QAAS,CACpDC,KAAM,UACNC,MAAO,OACPC,IAAK,YACJ,IALP,UAMMjJ,EAAMkJ,MANZ,eASH,eAAC,IAAU7D,KAAX,CAAgBD,MAAM,SAAtB,UACG,cAAC,IAAD,CACGG,UAAU,cACV4D,GAAG,IACHxG,QACGlE,EACMuJ,EAEE,kBAAMvG,EAAW,CAAEjC,aADnB,kBAAM2B,EAAWnB,IAEpB,kBAAM8H,EAAQsB,KAAK,WAR9B,SAWG,cAAC,IAAD,CAAMtD,GAAIuD,IAAS9D,UAAS,UAAKyC,EAAW,YAAc,UAE7D,cAAC,IAAD,CAAMzC,UAAW,CAAC,SAAU,WAA5B,SAAyCvF,EAAMb,QAC9C6H,EACE,cAACsC,EAAA,EAAD,IAEA,cAAC,IAAD,CACG/D,UAAW,CAAC,GAAD,OAAI8C,EAAgB,UAAY,YAC3CpF,UAAU,sBACVN,QACGlE,EAKQiK,EAJFL,EAIuB,kBAClBF,EAAgB,CAAEoB,UAAWvJ,EAAMI,QAAQvB,OAJzB,kBAClBoJ,EAAgB,CAAE7H,QAASJ,EAAMI,QAAQvB,QAK/C,kBAAMiJ,EAAQsB,KAAK,WAZ9B,6BAoBT,eAAC,IAAD,CAAW7D,UAAU,WAAWtC,UAAU,cAA1C,UACG,eAAC,IAAUoC,KAAX,CAAgBD,MAAM,SAASoE,GAAG,SAAlC,UACG,cAAC,IAAD,CAAO1D,GAAI2D,IAAMC,UAAU,IAAIC,GAAG,OAAOC,GAAE,mBAAc5J,EAAMI,QAAQvB,KAAvE,SACG,cAAC,IAAD,UACG,cAAC,IAAD,CAAO0G,UAAU,QAAQC,IAAKxF,EAAMI,QAAQC,MAAOsF,IAAI,qBAG7D,gCACG,cAAC,IAAD,CAAOG,GAAG,KAAKP,UAAU,UAAzB,SACIvF,EAAMI,QAAQF,QAElB,eAAC,IAAD,CAAMqF,UAAU,SAAhB,UAA0BvF,EAAMI,QAAQyJ,WAAxC,wBAGN,eAAC,IAAUxE,KAAX,WACIkD,EACE,cAAC,IAAD,CAAWhD,UAAU,QAArB,SAA8BvF,EAAM8J,cACnC,KACJ,cAAC,IAAD,CACGvE,UAAW,CAAC,SAAU,eACtB5C,QAAS,kBAAM6F,GAAoBD,IAFtC,SAIIA,EAAkB,YAAc,oBAI1C,cAAC,EAAD,cAnFZ,IAyFY9D,CAAf,IAKQsF,IAAMC,QAAN,+BAOGD,IAAMC,QAAN","file":"static/js/7.dd123519.chunk.js","sourcesContent":["import * as R from 'ramda';\r\nimport { userRequest } from '../apis/backend';\r\nimport { useQuery, useMutation, useQueryClient } from 'react-query';\r\nimport useAuth from 'context/auth/authContext';\r\n\r\nfunction useLikeItems() {\r\n\tconst [{ user }] = useAuth();\r\n\tconst result = useQuery({\r\n\t\tqueryKey: ['like-items', user?._id],\r\n\t\tqueryFn: () =>\r\n\t\t\tuserRequest\r\n\t\t\t\t.get(`/${user?._id}/likes`)\r\n\t\t\t\t.then(({ data: { data } }) => data.likes)\r\n\t\t\t\t.catch(({ response: { data } }) => {\r\n\t\t\t\t\tthrow data;\r\n\t\t\t\t})\r\n\t});\r\n\treturn { ...result, likeItems: result.data ?? [] };\r\n}\r\n\r\n/* eslint-disable */\r\nfunction useLikeItem(videoId) {\r\n\tconst [{ user }] = useAuth();\r\n\tif (!user) return null;\r\n\tconst { likeItems } = useLikeItems();\r\n\treturn likeItems.find((el) => el.videoId === videoId) ?? null;\r\n}\r\n\r\nfunction useCreateLikeItemInVideo(videoId) {\r\n\tconst [{ user }] = useAuth();\r\n\tconst queryClient = useQueryClient();\r\n\t//const defaultOptions = useDefaultMutationOptions(user?._id, videoId);\r\n\tconst mutation = useMutation(\r\n\t\t(video) =>\r\n\t\t\tuserRequest.post(`/${user?._id}/likes`, {\r\n\t\t\t\tvideoId: video.videoId,\r\n\t\t\t\ttitle: video.title,\r\n\t\t\t\tchannelTitle: video.channel.title,\r\n\t\t\t\timage: video.images,\r\n\t\t\t\tpublishedAt: video.publishedAt\r\n\t\t\t}),\r\n\t\t{\r\n\t\t\tonSettled: () => {\r\n\t\t\t\tqueryClient.invalidateQueries(['like-items', user?._id]);\r\n\t\t\t\tqueryClient.invalidateQueries(['videoInfo', { videoId }]);\r\n\t\t\t},\r\n\t\t\tonError: (err, variables, recover) => {\r\n\t\t\t\tif (typeof recover === 'function') {\r\n\t\t\t\t\t//() => queryClient.setQueryData(['videoInfo', { videoId }], prevVideoInfo);\r\n\t\t\t\t\trecover();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tonMutate: () => {\r\n\t\t\t\tconst prevVideoInfo = queryClient.getQueryData(['videoInfo', { videoId }]);\r\n\t\t\t\tqueryClient.setQueryData(['videoInfo', { videoId }], (oldData) => {\r\n\t\t\t\t\treturn { ...oldData, likes: oldData.likes + 1 };\r\n\t\t\t\t});\r\n\t\t\t\treturn () => queryClient.setQueryData(['videoInfo', { videoId }], prevVideoInfo);\r\n\t\t\t}\r\n\t\t}\r\n\t);\r\n\treturn { ...mutation, createLike: mutation.mutateAsync };\r\n}\r\n\r\nfunction useRemoveLikeItem() {\r\n\tconst [{ user }] = useAuth();\r\n\tconst queryClient = useQueryClient();\r\n\t//const defaultOptions = useDefaultMutationOptions(user?._id, videoId);\r\n\tconst mutation = useMutation(\r\n\t\t({ videoId }) => userRequest.delete(`/${user?._id}/likes/${videoId}`),\r\n\t\t{\r\n\t\t\tonSettled: () => {\r\n\t\t\t\tqueryClient.invalidateQueries(['like-items', user?._id]);\r\n\t\t\t},\r\n\t\t\tonError: (err, variables, recover) => {\r\n\t\t\t\tif (typeof recover === 'function') recover(); //() => queryClient.setQueryData(['like-items', user?._id], prevLikeItems);\r\n\t\t\t},\r\n\t\t\tonMutate: ({ videoId }) => {\r\n\t\t\t\tconst prevLikeItems = queryClient.getQueryData(['like-items', user?._id]);\r\n\t\t\t\tqueryClient.setQueryData(['like-items', user?._id], (oldData) => {\r\n\t\t\t\t\treturn R.reject((el) => el.videoId === videoId, oldData);\r\n\t\t\t\t});\r\n\t\t\t\treturn () => queryClient.setQueryData(['like-items', user?._id], prevLikeItems);\r\n\t\t\t}\r\n\t\t}\r\n\t);\r\n\treturn { ...mutation, removeLike: mutation.mutateAsync };\r\n}\r\n\r\nfunction useRemoveLikeItemInVideo(videoId) {\r\n\tconst [{ user }] = useAuth();\r\n\r\n\tconst queryClient = useQueryClient();\r\n\t//const defaultOptions = useDefaultMutationOptions(user?._id, videoId);\r\n\tconst mutation = useMutation(\r\n\t\t({ videoId }) => userRequest.delete(`/${user?._id}/likes/${videoId}`),\r\n\t\t{\r\n\t\t\tonSettled: () => {\r\n\t\t\t\tqueryClient.invalidateQueries(['like-items', user?._id]);\r\n\t\t\t\tqueryClient.invalidateQueries(['videoInfo', { videoId }]);\r\n\t\t\t},\r\n\t\t\tonError: (err, variables, recover) => {\r\n\t\t\t\tif (typeof recover === 'function') {\r\n\t\t\t\t\t() => queryClient.setQueryData(['videoInfo', { videoId }], prevVideoInfo);\r\n\t\t\t\t\trecover();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tonMutate: () => {\r\n\t\t\t\tconst prevVideoInfo = queryClient.getQueryData(['videoInfo', { videoId }]);\r\n\t\t\t\tqueryClient.setQueryData(['videoInfo', { videoId }], (oldData) => {\r\n\t\t\t\t\tif (!oldData) return;\r\n\t\t\t\t\treturn { ...oldData, likes: oldData.likes - 1 };\r\n\t\t\t\t});\r\n\t\t\t\treturn () => queryClient.setQueryData(['videoInfo', { videoId }], prevVideoInfo);\r\n\t\t\t}\r\n\t\t}\r\n\t);\r\n\treturn { ...mutation, removeLike: mutation.mutateAsync };\r\n}\r\n\r\nexport {\r\n\tuseLikeItems,\r\n\tuseLikeItem,\r\n\tuseRemoveLikeItem,\r\n\tuseCreateLikeItemInVideo,\r\n\tuseRemoveLikeItemInVideo\r\n};\r\n","import * as R from 'ramda';\r\nimport { videoRequest } from '../apis/backend';\r\nimport { useQuery, useMutation, useQueryClient } from 'react-query';\r\nimport { queryClient } from '../context';\r\n\r\nfunction useCommentSearch(videoId) {\r\n\tconst result = useQuery({\r\n\t\tqueryKey: ['commentSearch', { videoId }],\r\n\t\tqueryFn: () =>\r\n\t\t\tvideoRequest\r\n\t\t\t\t.get(`/${videoId}/comments`)\r\n\t\t\t\t.then(({ data: { data } }) => data.doc)\r\n\t\t\t\t.catch(({ response: { data } }) => {\r\n\t\t\t\t\tthrow data;\r\n\t\t\t\t})\r\n\t});\r\n\treturn { ...result, comments: result.data };\r\n}\r\n\r\nfunction useDefaultMutationOptions(videoId) {\r\n\tconst queryClient = useQueryClient();\r\n\treturn {\r\n\t\tonSettled: () => queryClient.invalidateQueries(['commentSearch', { videoId }])\r\n\t};\r\n}\r\n\r\nfunction useCreateComment(videoId, customOptions) {\r\n\tconst defaultOptions = useDefaultMutationOptions(videoId);\r\n\tconst mutation = useMutation((values) => videoRequest.post(`/${videoId}/comments`, values), {\r\n\t\t...defaultOptions,\r\n\t\t...customOptions\r\n\t});\r\n\treturn { ...mutation, create: mutation.mutateAsync };\r\n}\r\n\r\nfunction useUpdateComment(videoId, customOptions) {\r\n\tconst defaultOptions = useDefaultMutationOptions(videoId);\r\n\tconst mutation = useMutation(\r\n\t\t({ commentId, comment }) => videoRequest.patch(`/${videoId}/comments/${commentId}`, comment),\r\n\t\t{\r\n\t\t\t...defaultOptions,\r\n\t\t\t...customOptions\r\n\t\t}\r\n\t);\r\n\treturn { ...mutation, update: mutation.mutateAsync };\r\n}\r\n\r\nfunction useDeleteComment(videoId, customOptions) {\r\n\tconst defaultOptions = useDefaultMutationOptions(videoId);\r\n\tconst mutation = useMutation(\r\n\t\t({ commentId }) => videoRequest.delete(`/${videoId}/comments/${commentId}`),\r\n\t\t{\r\n\t\t\t...defaultOptions,\r\n\t\t\t...customOptions,\r\n\t\t\tonMutate: ({ commentId }) => {\r\n\t\t\t\tqueryClient.setQueryData(['commentSearch', { videoId }], (oldData) => {\r\n\t\t\t\t\treturn R.reject((el) => el._id === commentId, oldData);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t);\r\n\treturn { ...mutation, remove: mutation.mutate };\r\n}\r\n\r\nexport { useCommentSearch, useCreateComment, useUpdateComment, useDeleteComment };\r\n","import React, { useState, useContext, useRef, createContext, cloneElement } from 'react';\r\nimport { MenuList, MenuItem, Grow, Paper, Popper, ClickAwayListener } from '@material-ui/core';\r\n\r\nconst MenuContext = createContext();\r\n\r\nconst Menu = ({ children }) => {\r\n   const [isOpen, setIsOpen] = useState(false);\r\n   const anchorRef = useRef(null);\r\n   const value = { isOpen, setIsOpen, anchorRef };\r\n   return <MenuContext.Provider value={value}>{children}</MenuContext.Provider>;\r\n};\r\n\r\nconst MenuOpenButton = ({ children: child }) => {\r\n   const { setIsOpen, anchorRef } = useContext(MenuContext);\r\n   return cloneElement(child, {\r\n      onClick: callAll(() => setIsOpen(true), child.props.onClick),\r\n      ref: anchorRef\r\n   });\r\n};\r\n\r\nconst MenuCloseButton = ({ children: child }) => {\r\n   const { setIsOpen, anchorRef } = useContext(MenuContext);\r\n   return cloneElement(child, {\r\n      onClick: callAll(() => setIsOpen(false), child.props.onClick),\r\n      ref: anchorRef\r\n   });\r\n};\r\n\r\nconst MenuContent = ({ children, className }) => {\r\n   const { isOpen, setIsOpen, anchorRef } = useContext(MenuContext);\r\n\r\n   const handleClose = (event) => {\r\n      if (anchorRef.current && anchorRef.current.contains(event.target)) return;\r\n      setIsOpen(false);\r\n   };\r\n\r\n   return (\r\n      <Popper open={isOpen} anchorEl={anchorRef.current} transition>\r\n         {({ TransitionProps, placement }) => (\r\n            <Grow\r\n               {...TransitionProps}\r\n               style={{\r\n                  transformOrigin: placement === 'bottom' ? 'center top' : 'center bottom'\r\n               }}\r\n            >\r\n               <Paper>\r\n                  <ClickAwayListener onClickAway={handleClose}>\r\n                     <MenuList autoFocusItem={isOpen}>{children}</MenuList>\r\n                  </ClickAwayListener>\r\n               </Paper>\r\n            </Grow>\r\n         )}\r\n      </Popper>\r\n   );\r\n};\r\n\r\nfunction callAll(...fns) {\r\n   return function (...args) {\r\n      fns.forEach((fn) => {\r\n         fn && fn(...args);\r\n      });\r\n   };\r\n}\r\n\r\nexport { Menu, MenuItem, MenuOpenButton, MenuCloseButton, MenuContent };\r\n","import React from 'react';\r\nimport { useParams } from 'react-router-dom';\r\nimport styled from 'styled-components';\r\nimport { Button, Paragraph, ImageContainer, Image, ListGroup, Icon } from 'design/components';\r\nimport { Menu, MenuOpenButton, MenuCloseButton, MenuContent, MenuItem } from 'components/Menu';\r\nimport useAuth from 'context/auth/authContext';\r\nimport { useDeleteComment } from 'utils/comment';\r\nimport { MoreVert } from '@material-ui/icons';\r\n\r\nconst CommentItem = ({ comment, setCurrentTypedComment, className }) => {\r\n   const { videoId } = useParams();\r\n   const [{ user }] = useAuth();\r\n   const { remove } = useDeleteComment(videoId);\r\n\r\n   function renderActionBtn(comment) {\r\n      return (\r\n         <ListGroup.Item>\r\n            <Menu>\r\n               <MenuOpenButton>\r\n                  <Button modifiers='transparent'>\r\n                     <Icon as={MoreVert} />\r\n                  </Button>\r\n               </MenuOpenButton>\r\n               <MenuContent>\r\n                  <MenuCloseButton>\r\n                     <MenuItem onClick={() => setCurrentTypedComment(comment)}>Edit</MenuItem>\r\n                  </MenuCloseButton>\r\n                  <MenuCloseButton>\r\n                     <MenuItem onClick={() => remove({ commentId: comment._id })}>Delete</MenuItem>\r\n                  </MenuCloseButton>\r\n               </MenuContent>\r\n            </Menu>\r\n         </ListGroup.Item>\r\n      );\r\n   }\r\n\r\n   return (\r\n      <ListGroup flexy='center' className={className}>\r\n         <ListGroup.Item width='5'>\r\n            <ImageContainer>\r\n               <Image\r\n                  modifiers='round'\r\n                  src={`${process.env.REACT_APP_BACKEND_URL}/${comment.user.photo}`}\r\n                  alt='User Image'\r\n               />\r\n            </ImageContainer>\r\n         </ListGroup.Item>\r\n         <ListGroup.Item width='85' spacing='2.5'>\r\n            <Paragraph modifiers={['small', 'bold']}>{comment.user.name}</Paragraph>\r\n            <Paragraph modifiers='small'>{comment.comment}</Paragraph>\r\n         </ListGroup.Item>\r\n         {user && user._id === comment.user._id ? renderActionBtn(comment) : null}\r\n      </ListGroup>\r\n   );\r\n};\r\n\r\nexport default styled(CommentItem)`\r\n   &:not(:last-child) {\r\n      margin-bottom: 3rem;\r\n   }\r\n`;\r\n","import React, { useState, useEffect } from 'react';\r\nimport styled from 'styled-components';\r\nimport { useCommentSearch, useCreateComment, useUpdateComment } from 'utils/comment';\r\nimport { Form, Button, Input } from 'design/components';\r\nimport useAuth from 'context/auth/authContext';\r\nimport { useAsync } from 'utils/hooks';\r\nimport { useParams } from 'react-router-dom';\r\nimport { useForm } from 'react-hook-form';\r\nimport CommentItem from './CommentItem';\r\nimport { AreaSpinner } from 'components/Spinner';\r\n\r\nconst CommentView = ({ className }) => {\r\n   const [{ user }] = useAuth();\r\n   let { videoId } = useParams();\r\n   const { register, handleSubmit, setValue, reset } = useForm();\r\n   const [currentTypedComment, setCurrentTypedComment] = useState(null);\r\n   const { comments, isIdle, isLoading, isSuccess } = useCommentSearch(videoId);\r\n   const {\r\n      isLoading: isMutateLoading,\r\n      // isError: isMutateError,\r\n      // error: errorMutate,\r\n      run\r\n   } = useAsync();\r\n   const { create } = useCreateComment(videoId);\r\n   const { update } = useUpdateComment(videoId);\r\n   useEffect(() => {\r\n      if (currentTypedComment) setValue('comment', currentTypedComment.comment);\r\n   }, [currentTypedComment, setValue]);\r\n\r\n   function onCancelClick() {\r\n      reset();\r\n      setCurrentTypedComment(null);\r\n   }\r\n\r\n   function handleClick(values) {\r\n      if (!currentTypedComment) {\r\n         run(create(values));\r\n      } else {\r\n         run(update({ commentId: currentTypedComment._id, comment: values }));\r\n      }\r\n      setCurrentTypedComment(null);\r\n   }\r\n\r\n   function renderComments(list) {\r\n      return list?.map(function generateItem(comment) {\r\n         return (\r\n            <CommentItem\r\n               key={comment._id}\r\n               comment={comment}\r\n               setCurrentTypedComment={setCurrentTypedComment}\r\n            />\r\n         );\r\n      });\r\n   }\r\n\r\n   if (isIdle || isLoading || isMutateLoading) return <AreaSpinner />;\r\n   if (isSuccess)\r\n      return (\r\n         <div className={className}>\r\n            {user ? (\r\n               <Form className='comment__form' onSubmit={handleSubmit(handleClick)}>\r\n                  <Input\r\n                     modifiers='transparent'\r\n                     type='text'\r\n                     name='comment'\r\n                     placeholder='Add a public comment...'\r\n                     ref={register({\r\n                        required: 'Please type your comment'\r\n                     })}\r\n                  />\r\n                  <div className='comment__submitbox'>\r\n                     <Button onClick={onCancelClick}>Cancel</Button>\r\n                     <Button modifiers='secondary'>Comment</Button>\r\n                  </div>\r\n               </Form>\r\n            ) : null}\r\n            <div>{renderComments(comments)}</div>\r\n         </div>\r\n      );\r\n};\r\n\r\nexport default styled(CommentView)`\r\n   margin-top: 5rem;\r\n\r\n   .comment {\r\n      &__form {\r\n         margin: 3rem 0;\r\n      }\r\n\r\n      &__submitbox {\r\n         margin-top: 1rem;\r\n         display: flex;\r\n         justify-content: flex-end;\r\n      }\r\n   }\r\n`;\r\n","import React, { useState } from 'react';\r\nimport { Link, useParams } from 'react-router-dom';\r\nimport { useVideoInfo } from 'utils/video';\r\nimport {\r\n   useSubscribeItem,\r\n   useCreateSubscribeItemInVideo,\r\n   useRemoveSubscribeItemInVideo\r\n} from 'utils/subscription';\r\nimport { useLikeItem, useCreateLikeItemInVideo, useRemoveLikeItemInVideo } from 'utils/like';\r\nimport { useAsync } from 'utils/hooks';\r\nimport styled from 'styled-components';\r\nimport {\r\n   Col,\r\n   ImageContainer,\r\n   Link as SLink,\r\n   Video,\r\n   Title,\r\n   Paragraph,\r\n   ListGroup,\r\n   Button,\r\n   Icon,\r\n   Image,\r\n   Span\r\n} from 'design/components';\r\nimport { media } from 'design/utils';\r\nimport useAuth from 'context/auth/authContext';\r\nimport CommentView from 'screen/comment/CommentView';\r\nimport { ThumbUp } from '@material-ui/icons';\r\nimport { AreaSpinner, Spinner } from 'components/Spinner';\r\n\r\nconst VideoView = ({ history, className }) => {\r\n   const [{ user }] = useAuth();\r\n   const { videoId } = useParams();\r\n   const { video, isIdle, isLoading, isSuccess } = useVideoInfo(videoId);\r\n   const likeItem = useLikeItem(videoId);\r\n   const {\r\n      isLoading: isMutateLoading,\r\n      //isError: isMutateError,\r\n      //error: errorMutate,\r\n      run\r\n      //  reset\r\n   } = useAsync();\r\n\r\n   const { createSubscribe } = useCreateSubscribeItemInVideo(videoId);\r\n   const { removeSubscribe } = useRemoveSubscribeItemInVideo(videoId);\r\n   const { createLike } = useCreateLikeItemInVideo(videoId);\r\n   const { removeLike } = useRemoveLikeItemInVideo(videoId);\r\n   const subscribeItem = useSubscribeItem(video?.channel?._id || null);\r\n   const [descriptionShow, setDescriptionShow] = useState(false);\r\n   const videoSrc = `https://www.youtube.com/embed/${videoId}`;\r\n\r\n   function handleSubscribeClick(clickCB) {\r\n      return function () {\r\n         run(clickCB());\r\n      };\r\n   }\r\n\r\n   if (isIdle || isLoading)\r\n      return (\r\n         <Col width='10'>\r\n            <AreaSpinner />\r\n         </Col>\r\n      );\r\n   if (isSuccess)\r\n      return (\r\n         <Col width='10' className={className}>\r\n            <div className='video'>\r\n               <div className='video__videobox'>\r\n                  <Video src={videoSrc} title='video player' />\r\n               </div>\r\n               <ListGroup flexy='center' className='video__titlebox'>\r\n                  <ListGroup.Item width='70'>\r\n                     <Title modifiers='medium'>{video.title}</Title>\r\n                     <Paragraph modifiers='small'>\r\n                        {new Date(video.createdAt).toLocaleDateString('en-US', {\r\n                           year: 'numeric',\r\n                           month: 'long',\r\n                           day: 'numeric'\r\n                        })}{' '}\r\n                        • {video.views} views\r\n                     </Paragraph>\r\n                  </ListGroup.Item>\r\n                  <ListGroup.Item flexy='center'>\r\n                     <Button\r\n                        modifiers='transparent'\r\n                        pd='0'\r\n                        onClick={\r\n                           user\r\n                              ? !likeItem\r\n                                 ? () => createLike(video)\r\n                                 : () => removeLike({ videoId })\r\n                              : () => history.push('/login')\r\n                        }\r\n                     >\r\n                        <Icon as={ThumbUp} modifiers={`${likeItem ? 'secondary' : null}`} />\r\n                     </Button>\r\n                     <Span modifiers={['medium', 'regular']}>{video.likes}</Span>\r\n                     {isMutateLoading ? (\r\n                        <Spinner />\r\n                     ) : (\r\n                        <Button\r\n                           modifiers={[`${subscribeItem ? 'disable' : 'primary'}`]}\r\n                           className='video__subscribebtn'\r\n                           onClick={\r\n                              user\r\n                                 ? !subscribeItem\r\n                                    ? handleSubscribeClick(() =>\r\n                                         createSubscribe({ channel: video.channel._id })\r\n                                      )\r\n                                    : handleSubscribeClick(() =>\r\n                                         removeSubscribe({ channelId: video.channel._id })\r\n                                      )\r\n                                 : () => history.push('/login')\r\n                           }\r\n                        >\r\n                           Subscribe\r\n                        </Button>\r\n                     )}\r\n                  </ListGroup.Item>\r\n               </ListGroup>\r\n               <ListGroup modifiers='vertical' className='video__info'>\r\n                  <ListGroup.Item flexy='center' mb='0.5rem'>\r\n                     <SLink as={Link} flexwidth='5' mr='1rem' to={`/channel/${video.channel._id}`}>\r\n                        <ImageContainer>\r\n                           <Image modifiers='round' src={video.channel.image} alt='Author image' />\r\n                        </ImageContainer>\r\n                     </SLink>\r\n                     <div>\r\n                        <Title as='h2' modifiers='regular'>\r\n                           {video.channel.title}\r\n                        </Title>\r\n                        <Span modifiers='medium'>{video.channel.subscribes} subscribers</Span>\r\n                     </div>\r\n                  </ListGroup.Item>\r\n                  <ListGroup.Item>\r\n                     {descriptionShow ? (\r\n                        <Paragraph modifiers='small'>{video.description}</Paragraph>\r\n                     ) : null}\r\n                     <Button\r\n                        modifiers={['medium', 'transparent']}\r\n                        onClick={() => setDescriptionShow(!descriptionShow)}\r\n                     >\r\n                        {descriptionShow ? 'Show Less' : 'Show More'}\r\n                     </Button>\r\n                  </ListGroup.Item>\r\n               </ListGroup>\r\n               <CommentView />\r\n            </div>\r\n         </Col>\r\n      );\r\n};\r\n\r\nexport default styled(VideoView)`\r\n   .video {\r\n      width: 80%;\r\n      margin: 0 auto;\r\n      padding: 2rem 0rem;\r\n      ${media.tabport(`\r\n      width: 90%;\r\n      `)}\r\n\r\n      &__videobox {\r\n         box-shadow: var(--shadow-dark-shallow);\r\n         height: 37.5vw;\r\n         ${media.tabport(`\r\n      height: 45vw;\r\n      `)}\r\n      }\r\n\r\n      &__titlebox {\r\n         border-bottom: solid 0.1rem #000;\r\n         padding: 2rem 1rem;\r\n      }\r\n\r\n      &__subscribebtn {\r\n         flex: 0 0 15%;\r\n         margin-left: 2.5%;\r\n      }\r\n\r\n      &__info {\r\n         padding: 2rem 0;\r\n         border-bottom: solid 0.1rem #000;\r\n      }\r\n   }\r\n`;\r\n"],"sourceRoot":""}